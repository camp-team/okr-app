<div class="home-detail">
  <app-home-detail-title></app-home-detail-title>

  <div class="home-detail-table">
    <ng-container *ngFor="let primary of primaries; index as primaryArrayIndex">
      <p class="home-detail-table__titles">{{ primary.titles }}</p>
      <form [formGroup]="rows[primary.id]">
        <table class="home-detail-table__area">
          <thead>
            <tr>
              <th class="header-left">key</th>
              <th>target</th>
              <th>current</th>
              <th>percentage</th>
              <th class="header-right">lastUpdate</th>
            </tr>
          </thead>

          <tbody>
            <tr
              *ngFor="let row of rows[primary.id].controls; index as rowIndex"
            >
              <ng-container [formGroupName]="rowIndex">
                <td class="body-left">
                  <div
                    class="home-detail-table__open"
                    (click)="openOkrDialog(row.value.subTaskId)"
                  >
                    <mat-icon>open_in_full</mat-icon>
                    open
                  </div>
                  <input
                    (keyup)="
                      updateSubTaskData(
                        primary.id,
                        row.value.subTaskId,
                        row.value
                      )
                    "
                    type="text"
                    formControlName="key"
                    autocomplete="off"
                    required
                  />
                </td>
                <td>
                  <input
                    (keyup)="
                      updateSubTaskData(
                        primary.id,
                        row.value.subTaskId,
                        row.value
                      )
                    "
                    type="text"
                    formControlName="target"
                    autocomplete="off"
                    required
                  />
                </td>
                <td>
                  <input
                    (keyup)="
                      updateSubTaskData(
                        primary.id,
                        row.value.subTaskId,
                        row.value
                      )
                    "
                    type="text"
                    formControlName="current"
                    autocomplete="off"
                    required
                  />
                </td>
                <td>
                  <input
                    (keyup)="
                      updateSubTaskData(
                        primary.id,
                        row.value.subTaskId,
                        row.value
                      )
                    "
                    type="text"
                    formControlName="percentage"
                    autocomplete="off"
                    required
                  />
                </td>
                <td class="body-right">
                  <input
                    (keyup)="
                      updateSubTaskData(
                        primary.id,
                        row.value.subTaskId,
                        row.value
                      )
                    "
                    type="text"
                    formControlName="lastUpdated"
                    autocomplete="off"
                    required
                  />
                </td>
                <div
                  class="home-detail-table__remove"
                  type="button"
                  (click)="remove(primary.id, rowIndex)"
                >
                  remove
                </div>
              </ng-container>
            </tr>
          </tbody>
        </table>
      </form>
      <div class="home-detail-table__add-row" (click)="addRow(primary.id)">
        ï¼‹Add row
      </div>
      <div class="home-detail-table__average">
        <span class="home-detail-table__average-text">average</span
        >{{
          (primary.average / (rows[primary.id].controls.length * 100)) * 100
        }}%
      </div>
    </ng-container>
  </div>
</div>
